<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bản đồ số Phú Quốc — Mini-game hoàn chỉnh</title>

<!-- Bootstrap 5 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
  :root{
    --accent:#D32F2F; /* đỏ */
    --accent2:#FFD54F; /* vàng */
    --bg:#0b3d91; /* biển */
  }
  body{font-family:Inter, system-ui, sans-serif; background:linear-gradient(180deg,#fafafa,#fff); color:#222;}
  .hero{background: linear-gradient(90deg, rgba(11,61,145,0.12), rgba(211,47,47,0.02));padding:28px;border-radius:12px;margin-bottom:18px;}
  #map{height:66vh;border-radius:12px;box-shadow:0 6px 18px rgba(3,10,30,0.08);}
  .badge-grid img{width:64px;height:64px;object-fit:cover;border-radius:8px;}
  .site-brand{font-weight:700;color:var(--accent);}
  .diadic--title{font-weight:700;font-size:1.05rem;}
  .card-game{border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06);}
  footer{font-size:0.9rem;padding:18px 0;color:#666;}
  .custom-pin{cursor:pointer;}
</style>
</head>
<body>
<div class="container py-3">
  <!-- Header / Hero -->
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <div class="site-brand">Bản đồ số Phú Quốc</div>
      <div class="text-muted small">Dự án KHKT: Giáo dục lòng tự hào dân tộc — THPT An Thới</div>
    </div>
  </div>

  <div class="hero mb-3">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h2 class="mb-1">Khám phá di tích — Học lịch sử qua mini-game</h2>
        <p class="mb-0 text-secondary">Các điểm di tích trọng yếu có mini-game, hoàn thành sẽ nhận huy hiệu.</p>
      </div>
      <div class="col-md-4 text-md-end mt-3 mt-md-0">
        <a href="#map" class="btn btn-lg btn-accent" style="background:linear-gradient(90deg,#d32f2f,#ff7043);color:white">Khám phá bản đồ</a>
      </div>
    </div>
  </div>

  <!-- Map -->
  <div id="map" class="mb-3"></div>

  <!-- Badge strip -->
  <div class="card p-3 card-game mb-4">
    <div class="d-flex align-items-center justify-content-between">
      <div>
        <div class="diadic--title">Huy hiệu bạn đạt</div>
        <div class="text-muted small">(lưu tạm trên trình duyệt — demo)</div>
      </div>
      <div class="badge-grid d-flex gap-2" id="badge-list">
        <!-- badges appear here -->
      </div>
    </div>
  </div>

  <footer class="text-center text-muted">
    © Dự án KHKT — THPT An Thới — Demo GitHub Pages (miễn phí)
  </footer>
</div>

<!-- Modal di tích / mini-game -->
<div class="modal fade" id="diTichModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <button class="btn-close float-end" data-bs-dismiss="modal"></button>
        <div id="modalContent"></div>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap + Leaflet + Confetti -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
/* === Dữ liệu di tích === */
const diTichData = [
  {
    id: "nhatu_phuquoc",
    title: "Nhà tù Phú Quốc",
    lat: 10.299599, lng: 103.969697,
    short: "Nhà tù Phú Quốc - di tích lịch sử lớn về tù binh thời chiến. Giáo dục lòng yêu nước.",
    img: "https://upload.wikimedia.org/wikipedia/commons/3/3d/Nha_Tu_Phu_Quoc.jpg",
    hasGame: true,
    gameType: "quiz",
    gameId: "quiz_prison"
  },
  {
    id: "dinh_nguyentrungtruc",
    title: "Đình Nguyễn Trung Trực",
    lat: 10.219750, lng: 103.983600,
    short: "Đình thờ người anh hùng Nguyễn Trung Trực, nơi có lễ hội truyền thống.",
    img: "https://upload.wikimedia.org/wikipedia/commons/5/5f/Nguyen_Trung_Truc_temple.jpg",
    hasGame: true,
    gameType: "memory",
    gameId: "memory_trungtruc"
  },
  {
    id: "nhathung_nuocmam",
    title: "Nhà thùng nước mắm Phú Quốc",
    lat: 10.319330, lng: 103.990000,
    short: "Nhà thùng - đặc sản nước mắm Phú Quốc, nghề truyền thống.",
    img: "https://upload.wikimedia.org/wikipedia/commons/6/62/Phu_Quoc_fish_sauce_barrels.jpg",
    hasGame: true,
    gameType: "quiz",
    gameId: "quiz_nuocmam"
  }
];

/* === Khởi tạo bản đồ Leaflet === */
const map = L.map('map', {zoomControl:true}).setView([10.28, 103.97], 11);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'© OSM'}).addTo(map);

/* marker icons */
function makeIcon(color){
  return L.divIcon({className:'custom-pin', html: `<div style="background:${color};width:18px;height:18px;border-radius:50%;border:3px solid white"></div>`, iconSize:[24,24], iconAnchor:[12,12]});
}

/* add markers */
diTichData.forEach(p=>{
  const m = L.marker([p.lat,p.lng], {icon: makeIcon(p.hasGame ? '#D32F2F' : '#1976D2')}).addTo(map);
  m.on('click', ()=> openDiTich(p));
});

/* Modal */
const modalEl = document.getElementById('diTichModal');
const bsModal = new bootstrap.Modal(modalEl);

function openDiTich(p){
  let html = `
    <div class="row">
      <div class="col-md-6">
        <img src="${p.img}" alt="${p.title}" style="width:100%;border-radius:8px;object-fit:cover;">
      </div>
      <div class="col-md-6">
        <h4 class="mb-1">${p.title}</h4>
        <p class="text-muted small">${p.short}</p>
        <p><strong>Toạ độ:</strong> ${p.lat.toFixed(6)}, ${p.lng.toFixed(6)}</p>
        <div class="mt-3">
          ${p.hasGame ? `<button class="btn btn-danger me-2" onclick="startGame('${p.gameType}','${p.gameId}','${p.id}')">Chơi mini-game</button>` : ''}
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Đóng</button>
        </div>
      </div>
    </div>
  `;
  document.getElementById('modalContent').innerHTML = html;
  bsModal.show();
}

/* ===== Mini-game logic ===== */
const quizData = {
  quiz_prison:[
    {q:"Nhà tù Phú Quốc nổi tiếng vào thời kỳ nào?", a:["Thời chiến tranh Pháp","Thời chiến tranh Mỹ","Thời nhà Nguyễn"], correct:1},
    {q:"Mục đích chính của nhà tù?", a:["Tù binh chính trị","Trưng bày văn hóa","Lưu trú khách du lịch"], correct:0},
    {q:"Nhà tù Phú Quốc nằm trên đảo nào?", a:["Đảo Phú Quốc","Đảo Côn Sơn","Đảo Lý Sơn"], correct:0},
    {q:"Tên một chiến sĩ nổi tiếng bị giam?", a:["Nguyễn Văn Cừ","Nguyễn Trung Trực","Lê Văn Tám"], correct:1},
    {q:"Nhà tù hiện nay được dùng làm gì?", a:["Di tích lịch sử","Nhà máy","Trường học"], correct:0}
  ],
  quiz_nuocmam:[
    {q:"Phú Quốc nổi tiếng với sản phẩm gì?", a:["Nước mắm","Rượu vang","Trà xanh"], correct:0},
    {q:"Nguyên liệu chính làm nước mắm?", a:["Cá cơm","Cá hồi","Cá ngừ"], correct:0},
    {q:"Nhà thùng nước mắm dùng vật liệu gì?", a:["Gỗ","Thép","Nhựa"], correct:0}
  ]
};

/* Memory cards for Đình Nguyễn Trung Trực */
const memoryData = [
  {front:"Nguyễn Trung Trực", back:"Anh hùng dân tộc, chống Pháp"},
  {front:"Đình Nguyễn Trung Trực", back:"Nơi thờ Nguyễn Trung Trực"},
  {front:"Câu nói nổi tiếng", back:"Không có gì quý hơn độc lập tự do"}
];

function startGame(type, gameId, diId){
  bsModal.hide();
  if(type==="quiz"){
    runQuiz(gameId,diId);
  }else if(type==="memory"){
    runMemory(diId);
  }
}

/* ===== Quiz ===== */
function runQuiz(gameId,diId){
  const quiz = quizData[gameId];
  if(!quiz) return;
  let html=`<h4>Mini-Quiz</h4><form id="quizForm">`;
  quiz.forEach((q,i)=>{
    html+=`<div class="mb-2"><strong>${i+1}. ${q.q}</strong><br>`;
    q.a.forEach((opt,j)=>{
      html+=`<div class="form-check"><input class="form-check-input" type="radio" name="q${i}" id="q${i}o${j}" value="${j}"><label class="form-check-label" for="q${i}o${j}">${opt}</label></div>`;
    });
    html+=`</div>`;
  });
  html+=`<button class="btn btn-success" type="submit">Nộp</button></form>`;
  document.getElementById('modalContent').innerHTML=html;
  bsModal.show();

  document.getElementById('quizForm').onsubmit=function(e){
    e.preventDefault();
    let score=0;
    quiz.forEach((q,i)=>{
      const sel=document.querySelector(`input[name=q${i}]:checked`);
      if(sel && parseInt(sel.value)===q.correct) score++;
    });
    alert(`Bạn trả lời đúng ${score}/${quiz.length} câu!`);
    if(score>=quiz.length/2) awardBadge(diId,diId);
    bsModal.hide();
    confetti({particleCount:100,spread:70,origin:{y:0.6}});
  }
}

/* ===== Memory ===== */
function runMemory(diId){
  const cards=memoryData.concat(memoryData).sort(()=>Math.random()-0.5);
  let html=`<h4>Memory Game</h4><div class="d-flex flex-wrap gap-2" id="memCards">`;
  cards.forEach((c,i)=> html+=`<div class="card p-2 text-center" style="width:100px;height:80px;border:1px solid #ccc;border-radius:6px;cursor:pointer" data-front="${c.front}" data-back="${c.back}">?</div>`);
  html+=`</div><button class="btn btn-outline-secondary mt-3" onclick="bsModal.hide()">Đóng</button>`;
  document.getElementById('modalContent').innerHTML=html;
  bsModal.show();

  let first=null, second=null;
  const elements=document.querySelectorAll("#memCards div");
  elements.forEach(el=>{
    el.addEventListener('click',()=>{
      if(el.innerText!=="?") return;
      el.innerText=el.dataset.front;
      if(!first){first=el; return;}
      second=el;
      if(first.dataset.back===second.dataset.back){
        setTimeout(()=>{first.style.background="#D32F2F"; second.style.background="#D32F2F"; first.innerText=second.innerText=""; first=null; second=null; awardBadge(diId,diId); confetti({particleCount:100,spread:70,origin:{y:0.6}})},200);
      }else{
        setTimeout(()=>{first.innerText=second.innerText="?"; first=null; second=null;},500);
      }
    });
  });
}

/* ===== Badge logic ===== */
function awardBadge(name,diId){
  const k='pq_badges';
  const arr=JSON.parse(localStorage.getItem(k)||'[]');
  if(!arr.find(b=>b.name===name)){
    arr.push({name,diId,at:new Date().toISOString()});
    localStorage.setItem(k,JSON.stringify(arr));
    renderBadges();
  }
}

function renderBadges(){
  const k='pq_badges';
  const arr=JSON.parse(localStorage.getItem(k)||'[]');
  const wrap=document.getElementById('badge-list');
  wrap.innerHTML='';
  arr.forEach(b=>{
    const el=document.createElement('div');
    el.innerHTML=`<div class="text-center"><img src="https://via.placeholder.com/64/FF7043/FFFFFF?text=${encodeURIComponent(b.name.charAt(0))}" alt="${b.name}" title="${b.name}" class="rounded"/><div style="font-size:12px">${b.name}</div></div>`;
    wrap.appendChild(el);
  });
}
renderBadges();
</script>
</body>
</html>
